# 지옥 스터디 - 08 스프링이란 무엇인가

## 스프링의 정의
- 스프링은 이런 것이다 라고 한마디로 정의하기란 쉽지 않다.
- 스프링을 그때 그때 필요한 API 사용방법 위주로만 학습하면, 스프링을 오해하거나 가치를 충분히 누리지 못할 수 있다.
- 때문에 한번 쯤 스프링의 정의를 통해 스프링의 어떤 것인지 에 대한 큰 그림을 이해해볼 필요가 있다.
- 스프링에 대해 잘 알려진 정의는 다음과 같다.

```text
자바 엔터프레이즈 개발을 편하게 해주는 오픈소스 경량급 "애플리케이션 프레임워크"
```

### 애플리케이션 프레임워크
- 일반적으로 라이브러리/프레임워크 는 특정 업무 분야나 한 가지 기술에 **특화된 목표** 를 가지고 있다.
- 하지만 스프링은 이와 다르게 **애플리케이션 전 영역을 포괄하는 범용적인 프레임워크** 이다.
  - 애플리케이션 개발의 전 과정을 빠르고 편리하며 효율적으로 진행하는데 일차적인 목표를 두는 프레임워크 이다.
- 단지 여러 계층의 다양한 기술을 한데 모아뒀기 때문에 애플리케이션 프레임워크라고 하는것은 아니다.
- 애플리케이션 전 영역을 관통하는 일관된 프로그래밍 모델과 핵심 기술을 바탕으로 해서 각 분야의 특성에 맞는 필요를 채워주고 있다.
- 때문에 애플리케이션을 빠르고 효과적으로 개발할 수 있다.

### 경량급
- 스프링이 경량급이 라는 것은 스프링 자체가 아무 가볍거나 작은 규모의 코드로 이루어졌다는 것은 아니다.
- 스프링이 가볍다고 하는것은, 불필요하게 무겁지 않다는 의미이다.
- EJB 같은 기술과 스프링을 대비시켜 설명하기 위해 사용됬던 표현이다.
- 결과적으로 스프링은 EJB 를 대표로 하는 많은 기존 기술들이 불필욯게 무겁고 복잡했음을 증명했다.
- 그런 면에서 스프링은 군더더기 없이 깔끔한 기술을 가진 **경량급** 프레임워크 라고 불린 것이다.

### 자바 엔터프라이즈 개발을 편하게
- 기존에 등장했던 대부분의 자바 엔터프라이즈 기술/프레임워크 들은 개발을 편하게 해준다 고 주장하고 있다.
- 하지만 스프링에 주장하는 것은 무게가 다르다.
- 이는 근본적인 부분에서 진정 개발을 편하게 해주는 해결책을 제시한다.
- 개발자가 복잡하고 실수하기 쉬운 로우레벨 기술에 많은 신경을 쓰지 않으면서도 애플리케이션 핵심인 비즈니스 로직을 빠르고 효과적으로 구현할 수 있게 해준다.

### 오프소스
- 스프링은 오픈소스 프로젝트로 개발되었고, 지금도 오픈소스로 개발되는 중이다.
- 오픈소스의 장점은 투명한 방식으로 다양한 참여를 통해 개발되기 때문에 매우 빠르고 유연한 개발이 가능하다.
- 사용자는 소스를 받아 품질 / 기능을 얼마든지 검증하고 분석할 수 있다.
- 발견한 버그를 신고하거나 기능 개선을 제안했다면 어떻게 처리되는지 지켜볼 수도 있다.

## 스프링의 목적
- 그저 스프링을 가져다 쓰는 수준이라면 스프링을 **적용** 한 것이지 스프링의 활용해 개발했다고 할 순 없다.
- 스프링은 그 기능과 API 사용법을 안다고해서 잘 쓰는것이 아니다.
- 개발을 잘하려면 결국 근본적인 프로그래밍 실력이 필요하다.
- 근본적인 목적은 객체지향 프로그래밍을 통해 유연하고 확장성이 좋은 애플리케이션을 만드는 것이다.
- 자바를 가져다 절차지향 언어처럼 사용한다면 그 가치를 얻을 수 없다.
- 이는 스프링도 마찬가지 잉다.
- 스프링이 제공해주는 DI 를 활용한다고 해서 좋은 설계, 확장성 좋은 설계라고 할 순 없는 것이다.

### 객체지향과 DI
- 스프링의 모토는 **기본으로 돌아가자** 이다.
- 자바의 기본인 객체지향 에 충실한 설계가 가능하도록 단순한 오브젝트로 개발할 수 있고, 객체지향 설계 기법을 잘 적용할 수 있는 구조를 만들기 위해 DI 같은 유용한 기술을 편하게 적용하도록 도와주는 것이 스프링의 기본 전략이다.
- 기술적인 복잡함을 효과적으로 다루게 해주는 기법들은 모두 DI 를 바탕으로 하고 있다.
- 서비스 추상화, 템플릿/콜백, AOP 와 같은 스프링의 기술은 DI 없이는 존재할 수 없는 것들이다.
- 객체지향 언어를 쓴다고 객체지향 설계가 되고 객체지향 프로그래밍이 되는것은 아니다.
- DI 를 의식하다보면 오브젝트 설계시 자주 **DI 를 적용할 후보가 없을까** 를 고민하게 된다.
  - 여기서 바뀔수 있는건 뭘까 ?
  - 성격이 다르고, 변경의 이유가 다른 기능은 무엇일까 ?
- DI 는 좋은 오브젝트 설계의 결과물이기도 하지만 DI 를 열심히 적용하다 보면 객체지향 설계 원칙을 잘 따르고 장점을 살린 설계가 나올 수도 있다.

## POJO 프로그래밍

### 스프링의 핵심 : POJO
- 스프링의 주요기술인 IoC/DI, AOP, PSA 는 애플리케이션을 POJO 로 개발할 수 있게 해주는 **가능 기술 (enable technology)** 이라고 불린다.

### POJO 란 무엇인가 ?
- POJO 는, Plain Old Java Object 의 약자이다.
- 마틴파울러가 컨퍼런스 발표 준비를 하다가 만든 용어
- 이는 단순한 자바 오브젝트를 의미한다.
- POJO 는 다음 세가지 조건을 충족해야 비로서 POJO 라 불릴만 하다.
  1. 특정 규약에 종속되지 않는다.
     - 자바 언어와 꼭 필요한 API 외에 종속되지 않아야 한다.
     - EJB 와 같이 특정 규약에 따라 개발을 해야한다면 POJO 가 아니다.
     - 스트럿츠와 마찬가지로 특정 클래스를 상속해야 하는것도 마찬가지이다.
  2. 특정 환경에 종속되지 않는다.
     - JNDI 와 같은 특정 환경이 의존대상 검색 방식에 종속적이라면 POJO 라 할 수 없다.
     - 특정 벤더나 서버의 API 의 코드를 갖고 있거나 하는 경우에도 POJO 가 아니다.
     - 비즈니스 로직을 담은 코드에 HttpServletRequest, HttpSession 등을 직접 사용한다면 POJO 라 할 수 없다.

> 단순하게 특정 기술과 환경에 종속되지 않는다고 POJO 라 할 수 있는것이 아니다. <br/>
> 책임과 역할이 각기 다른 코드를 한 클래스에 때려박아 만능 클래스로 만드는 경우와 같은 상황잉라면 객체지향 적인 자바 오브젝트라고 할 수 없다. <br/>
> 그런 방식으로 설계되고 개발된 객체라면 POJO 라 부르기 힘들다.

- 진정한 POJO 는 **객체지향 적인 원리에 충실하면서 환경/기술에 종속되지 않고 필요에 따라 재활용될 수 있는 방식으로 설계된 오브젝트** 를 말한다.

### POJO 의 장점
- POJO 의 장점은, POJO 가 될 수 있는 조건이 그대로 장점이 된다.
- 특정기술, 환경에 종속되지 않기 때문에 깔끔한 코드가 된다.
- 자동화된 테스트에 유리하다. (특정 환경에 종속되지 않음)
- 객체지향 설계를 자유롭게 적용할 수 있다.

### POJO 프레임워크
- 스프링은 POJO 를 이용한 엔터프라이즈 애플리케이션 개발을 목적으로 하는 프레임워크이다.
- POJO 프로그래밍이 가능하도록 기술적인 기반을 제공하는 프레임워크 = POJO 프레임워크 라고 한다.
  - 스프링/하이버네이트 가 대표적인 POJO 프레임워크
- 스프링을 사용한다고 해서 객체지향 적이고 POJO 프로그래밍을 자연스럽게 할 수 있는 것이 아니다.
- **의식적인 훈련과 지속적인 개선 욕구, 설계에 대한 고민** 을 꾸준히 해야 한다.

## 스프링의 기술

### IoC/DI
- IoC/DI 는 스프링의 가장 기본이 되는 기술이자, 스프링의 핵심 개발 원칙이다.
- AOP, PSA 도 IoC/DI 에 바탕을 두고 있다.
- 자주 등장하는 템플릿/콜백 패턴도 IoC/DI 가 핵심 원리
- DI 를 하는 이유 ? -> 유연한 확장이 가능하게 하기 위함
- DI = OCP 로 잘 설명 된다.

`DI 활용법`
- DI 의 가장 대표적인 적용 방법 = 의존 대상 구현의 변경
  - 전략 패턴이 가장 대표적인 예
  - 실제 **의존대상이 가진 핵심기능을 DI 를 통해 변경** 하는 것
- 두 번째 적용 방법 = 의존 오브젝트의 핵심 기능 자체를 바꾸는 것
  - 런타임 의존 대상을 다이나믹하게 변경할 수 있다.
  - DAO 는 DataSource 인터페이스에 의존한다.
  - 등급에 따라 성능이 더 좋은 DB 를 사용할 수 있게 한다.
- 세 번째 적용 방법 - 부가기능의 추가
  - 데코레이터 패턴이 대표적인 예
  - ex) 트랜잭션

`인터페이스의 변경`
- 인터페이스가 다른 다양한 구현을 같은 방식으로 사용하도록 **어댑터** 를 둘 수 있다.
- 스프링의 대표적인 기술중 하나인 **서비스 추상화** 이다.
- 클라이언트가 일관성 있게 사용가능한 인터페이스를 제공해주고, DI 를 통해 어댑터 역할을 하는 것을 말한다.

`프록시`
- 프록시 패턴의 응용방법 -> Lazy-Loading 방식
- 스프링은 EJB 원격호출, 웹서비스, REST 등 다양한 리모팅 기술을 지원한다.

`템플릿/콜백`
- 템플릿/콜백은 DI 의 특별한 적용 방법
- DI 원리를 응용해 지저분하게 매번 만들어야 하는 코드를 간결하게 만들 수 있다.
- 템플릿은 계속 만들어두면 재사용 가능하고, 기능확장에도 변하지 않는다는 점에서 OCP 를 만족한다.

`싱글톤과 오브젝트 스코프`
- DI 가 필요한 중요한 이유는 DI 할 오브젝트의 생명주기를 제어할 수 있다는 것
- DI 를 프레임워크로 이용한다 => DI 대상을 컨테이너가 관리한다.
  - 오브젝트 스코프를 자유롭게 제어할 수 있다.
- 가장 기본이 되는 스코프 = 싱글톤
- 엔터프라이즈 개발에서 서비스 오브젝트는 싱글톤으로 관리되어야 한다.
- 전통적인 싱글톤 패턴은 제약사항이 많아 안티패턴으로 불린다.
- 스프링 DI 는 기본적으로 싱글톤으로 만들어 사용한다.
- 컨테이너가 싱글톤을 보장해주기 때문에 클래스 자체는 싱글톤을 고려하지 않은 설계를 해도 된다는 장점이 있다.
- 그 외에도 HTTP 요청 당 하나, HTTP 세션 당 하나 등 대양한 스코프를 제공해 준다.

`테스트`
- DI 의 중요한 용도는 테스트
- 여러 오브젝트와 협력해서 동작하는 객체를 효과적으로 테스트하는 방법 = 최대한 고립시켜라.
- 다른 오브젝트와의 사이에서 일어날 수 있는 일을 위해 조작할 수 있도록 만들어야 한다.
- 그래야 테스트 대상인 오브젝트의 기능에 충실한 테스트가 가능하다.
- 자칫 잘못하다가는 DB, 환경 심지어 네트워크까지 테스트를 해야하는 상황이 올 수 있다.

### AOP
- AOP 는 스프링 3대 기술중 하나이다.
- AOP 는 OOP 처럼 독립적인 프로그래밍 패러다임이 아니다.
- OOP 의 한계/단점 을 보완하는 기술이다.

`AOP 적용 방법`
- 프록시 기반
  - 스프링 다이나믹 프록시를 활용 하는 방법
  - 대부분의 경우 해결이 가능하다.
- AspectJ 기반
  - 프록시 기반의 한계를 넘어선 적용이 필요한 경우
  - 단점은 자바/JDK 만으로 사용이 불가능하다.
> AspectJ 를 꼭 사용해야 한다면 그때 사용 할 것.

### PSA
- 일관된 방식으로 기술에 접근이 가능하도록 해주는 PSA 이다.
- POJO 로 개발된 코드는 특정 환경이나 구현에 종속되어서는 안된다.
- 종속되지 말아야 한다는 것이 그 기술을 사용하지 말라는 뜻은 아니다.
- POJO 코드가 그런 기술에 직접 노출되어 만들어지지 않아야 한다는 의미이다.
- 이를 위해 제공하는 것이 **일관성 있는 서비스 추상화** 이다.
  - 트랜잭션, 캐시, OXM 등등..