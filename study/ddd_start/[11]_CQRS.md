# CQRS
- 명령모델과 조회 모델
- CQRS 의 장단점

## 단일 모델의 단점
- 주문 내역 조회 기능 구현시, 여러 애그리거트에서 데이터를 가져와야 한다.
- 조회 특성상 속도가 빠를수록 좋다.
- 여러 애그리거트를 거쳐 데이터를 가져와야 한다면, 구현 방법을 고민해야 한다.
- ID 참조 방식을 사용하면, JPA 의 즉시로딩 같은 쿼리 최적화를 사용할 수 없다.
- 객체 참조 방식을 사용해도, 조회 화면 특성에 따라 즉시 로딩이나 지연 로딩 처리를 해야 한다.

> 위와 같은 고민이 생기는 이유 ? => 시스템 상태변경과 조회의 모델을 동일하게 사용하기 때문이다.

## CQRS
- 시스템이 제공하는 기능은 크게 두 가지로 나눠볼 수 있음
  - 상태 변경
  - 데이터 조회
- 상태변경은 주로 한 애그리거트의 상태를 변경한다.
- 데이터 조회는 여러 애그리거트를 조회할 수 있다.
- 상태를 변경하는 범위와, 조회하는 범위가 일치하지 않기 때문에, 단일 모델로 두 종류의 기능을 모두 구현하면 모델이 불필요하게 복잡해진다.
- 이를 해결하기 위한 방법 => CQRS
- CQRS 는 복잡한 도메인에 적합하다.
- 도메인이 복잡할수록 명령 과 조회 기능이 다루는 데이터 범위에 차이가 발생한다.
- 이런 도메인에 CQRS 를 적용한다면 조회 모델을 별도로 만들기 떄문에, 조회때문에 도메인 모델이 복잡해지는 것을 막을 수 있음
- CQRS 사용시 각 모델에 맞는 구현 기술을 택할 수 있다.
- 명령 모델은 객체지향에 기반해 도메인 모델 구현하기 좋은 JPA 를 사용하고, 조회는 SQL 로 조회하기 좋은 MyBatis 를 사용해 구현할 ㅅ ㅜ있다.
- 명령 모델과, 조회모델이 같은 기술을 사용할 수도 있고, 서로 다른 저장소를 사용할 수 있다.

## 웹과 CQRS
- 일반적인 웹 서비스라면 상태 변경보다는 조회가 많다.
- 조회 성능을 높이기 위해 다양한 기법을 사용한다.
- 쿼리 최적화는 물론, 메모리에 캐시하고, 조회 전용 젖아소를 따로 구축하기도 한다.
- 이는 결과적으로 CQRS 를 적용하는 것과 같은 효과를 만든다.
- 대규모 트래픽이 발생하는 웹 서비스는 알게 모르게 CQRS 를 적용하게 된다.
- 단지 명시적인 모델 분리를 하지 않을 뿐이다.

## CQRS 의 장단점
- 장점은 명령 모델 구현시 도메인 자체에 집중할 수 있다.
- 명령 모델과 조회 모델을 구현하면, 조회를 위한 코드가 명령 모델에 없으므로 도메인 로직 구현에 집중이 가능하다.
- 조회 성능을 향상시키는 데도 유리하다.
- 단점은 구현할 코드가 더 많다.
- 구현비용을 따져봐야 한다.
- 단순한 도메인이거나 트래픽이 많지않은 서비스라면 조회 전용 모델을 만들 이유가 없다.
- 추가적으로 더 많은 구현 기술이 필요하다.
- 이런 장단점을 고려해 CQRS 패턴을 도입할지 여부를 결정해야 한다.