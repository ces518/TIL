# 지옥자바 스터디 - 13 쓰레드

## 프로세스와 쓰레드

`프로세스 (process)`
- **프로세스 (process)** 란, 간단히 말하면 실행중인 프로그램
  - 메모리에 올라와 **실행중인 프로그램의 인스턴스 (독립적인 개체)**
  - 운영체제로 부터 시스템 자원을 할당받는 **작업 단위**  
- 할당받는 시스템 자원
  - CPU 시간
  - 필요한 주소 공간
  - Code, Data, Stack, Heap 구조의 독립된 메모리 공간
- 특징
  - 프로세스는 각각 **독립된 메모리 영역을 할당** 받는다
  - 프로세스당 **최소 1개의 스레드 (메인 스레드)** 를 가지고 있다
  - 각 프로세스는 별도의 주소 공간에서 실행되며, 프로세스간의 변수 등 자원에 직접 접근이 불가능하다.
  - 프로세스 간의 자원에 접근하려면 프로세스간 통신을 통해서 가능하다
    - 파이프, 파일, 소켓 등..

`쓰레드 (thread)`
- **쓰레드 (thread)** 란, 프로세스 내에서 실행되는 흐름 단위, **실행의 최소단위**
  - 예전에는 최소 단위가 process 였지만, 멀티쓰레드 환경으로 넘어오면서 Thread 로 전환 되었다
  - 실행 최소단위가 Thread 라고 해서 process 가 의미 없는 것은 아니다
- 특징
  - 쓰레드는 프로세스 내에서 Stack 만 할당받고, 나머지 메모리 영역은 공유한다 (프로세스 내의 자원을 쓰레드 끼리 공유)
  - 멀티 쓰레드 환경의 경우 Thread-Safe 여부에 따라 잘못된 결과를 초례할 수 있다

> 프로세스 간의 데이터 공유는 커널레벨에서 제공해주는 서비스를 사용해야한다. <br/>
> 반면 쓰레드는 메모리 영역을 공유하기 때문에 손쉽게 가능하다.

`자바와 프로세스 / 쓰레드`
- 자바는 Thread 기반으로 동작하며, 언어레벨에서 Thread 를 지원한다
- 자바는 실행되는 순간 해당 자바 프로그램 자체가 **하나의 프로세스** 가 되기 때문에 쓰레드만이 존재할 수 있다
- 자바의 쓰레드는 JVM 이 운영체제의 역할을 수행 한다
  - JVM 에 의해 스케쥴되는 실행단위 코드블록 이라고 한다
- JVM 이 관리하는 쓰레드 정보
  - 쓰레드의 갯수
  - 쓰레드로 인해 실행되는 코드의 메모리 주소
  - 쓰레드의 상태
  - 쓰레드의 우선순위

`멀티태스킹과 멀티쓰레딩`
- 대부분의 OS 는 **멀티 테스킹 (multi-tasking)** 을 지원하기 때문에 여러 프로세스가 동시에 실행될 수 있다
- 이와 비슷하게 **멀티 쓰레딩 (multi-threading)** 은 하나의 프로세스 내에서 여러 쓰레드가 동시에 작업을 수행하는 것이다
  - CPU 의 코어는 한번에 하나의 작업만 수행가능 하기때문에 실제로는 매우 짧은 순간에 여러번 작업을 번갈아가며 수행하므로 동시에 진행하는 것 처럼 보인다
- 실제 동시에 처리되는 작업이 이뤄지는 것은 CPU 의 코어 수와 일치한다

> 프로세스의 성능이 쓰레드의 갯수가 많다고 좋아지는 것은 아니며 오히려 두 개의 쓰레드를 가진 프로세스가 더 낮은 성능일 보일 때도 있다

`멀티쓰레딩의 장단점`
- CPU 사용률 향상
- 효율적인 자원 사용
- 응답성 향상
- 작업의 분리

> 쓰레드는 가벼운 프로세스, LWP (Light-Weight-Process) 라고 부르기도 한다. <br/>
> 하지만 쓰레드 끼리 공유하는 자원이 있기 때문에 **동기화나 교착상태와 같은 문제** 들이 늘 따라다닌다.

## 쓰레드의 구현과 실행
1. Thread 클래스를 상속 (서브 클래싱) 하는 방법
    - 상속받는 하위 클래스를 선언하고, **run() 메소드를 오버라이딩** 한다
    - 구현 클래스의 인스턴스를 생성하고, start() 메소드를 호출해 실행한다
2. Runnable 인터페이스를 구현한 뒤 쓰레드의 생성자로 넘기는 방법
    - Runnable 인터페이스는 run() 메소드 하나만 가지고 있다
    - Runnable 인터페이스를 구현한 뒤 Thread 의 생성자로 넘겨준다

// TODO Thread Command 패턴 / Strategy 패턴 내용 정리
