# 지옥자바 스터디 - 10 날짜와 시간 & 형식화

## 날짜와 시간

### Calendar 와 Date
- Date 클래스는 날짜와 시간을 다루는 목적으로 JDK 1.0 부터 제공된 클래스
- Calendar 클래스는 JDK1.1 부터 제공된 클래스 이다.
  - Date 클래스의 기능이 부족했기 때문에 서둘러 추가됨
- Date 클래스의 단점을 보완하기 위해 Calendar 클래스가 추가 되었지만 몇가지 단점이 발견되었다.
- 때문에 JDK1.8 부터 JodaTime 을 본따 LocalDateTime 등이 추가 되었다. (JSR-310)

`1582년 10월 4일의 다음날은 ?`

![Calander Test](./images/Calander_Test.png)

![Test Results](./images/Test_Results.png)
- 위 테스트는 실패한다.
- 1582년에서 사라진 10일은, 그레고리력을 처음 적용하면서 율리우스력에 의해 누적된 오차를 교정하기 위해 건너뛴 기간...
- 위 코드에서 getInstance() 는 **GregorianCalendar** 의 인스턴스를 반환하고 있다.
  - 이는 그레고리력과 율리우스력을 같이 구현하고 있다.
- AD 4년의 3월 1일 이전에는 윤년을 불규칙하게 두었기 때문에 GregorianCalendar 클래스로 구한 날짜는 정확하지는 않다

> 이외에도 썸머타임 등의 문제가 있음..

`JDK 기본 날짜 클래스의 문제`
- Immutable 하지 않음
- int 상수 필드를 남용하고 있음
- 실수를 유발하기 쉬운 월 지정
- 일관성이 없는 요일 상수
- Date / Calendar 의 불편한 역할 분담
- 오류에 둔감한 시간대 ID 지정
- java.util.Date 하위 클래스 문제

### Calendar 와 GregorianCalendar
- Calendar 는 추상 클래스이다.
  - Calendar.getInstance() 메소드는 이를 구현한 클래스의 인스턴스를 반환
  - 구현 클래스로는 GregorianCalendar / BuddhistCalendar (태국) 가 있다.

> getInstance() 로 얻은 인스턴스는 기본적으로 현재 시스템 날짜와 시간에 대한 정보를 담고 있다. <br/>
> 현재 설정된 Locale 정보를 기반으로 GregorianCalendar / BuddhistCalendar 중 하나의 인스턴스를 반환한다.

```java
public static Calendar getInstance() {
    Locale aLocale = Locale.getDefault(Locale.Category.FORMAT);
    return createCalendar(defaultTimeZone(aLocale), aLocale);
}
```

### Date 와 Calendar 간의 변환
- Calendar 클래스가 추가 됨으로 인해 Date 클래스의 대부분 메소드가 deprecated 되었다.

```java
// Calendar to Date
Calendar cal = Calendar.getInstnace();
Date d = new Date(cal.getTimeInMillis());

// Date to Calendar
Date d = new Date();
Calendar cal = Calendar.getInstance();
cal.setTime(d);
```

`Calendar.add 와 Calendar.roll`
- add 와 roll 메소드 모두 지정한 필드 값을 원하는 만큼 증가 혹은 감소 시키는 메소드이다.
- 이둘의 차이는 **다른 필드 영향의 유무**
- add 메소드로 Calendar.DATE 의 값을 31 만큼 증가 시켰다면 다음 달로 넘어가므로 Calendar.MONTH 의 값도 증가하지만 roll 메소드는 일 필드만 변경된다.

> 한 가지 예외 상황으로는 Calendar.DATE 필드가 **말일** 일 때, roll 메소드로 Calendar.MONTH 필드를 변경하면 일 필드에 영향을 미칠 수 있다. 

## 형식화 클래스

### DecimalFormat
- 숫자를 형식화 하기 위해 제공되는 클래스
- 숫자 -> 정수, 부동소수점, 금액 등 다양한 형식으로 표현이 가능하다.
- 형식화 클래스 에서는 원하는 형식으로 표현 / 변환하기 위해 **패턴** 을 정의한다.

| 기호 | 의미 | 패턴 | 결과 |
| --- | --- | --- | --- |
| 0 | 10진수 (값이 없다면 0) | 0 <br/> 0.0 | 12345678 <br/> 1234567.9 |
| # | 10진수 | # <br/> #.# | 12345678 <br/> 12345678.9 |
| . | 소수점 | #.# | 1234567.9 |
| - | 음수부호 | #.#- <br/> -#.# | 1234567.9- <br/> -1234567.9 |
| , | 단위 구분자 | #,###,## | 1,234,567,89 |

> 위 패턴 외에도 지원하는 다양한 패턴이 존재함

```java
double number = 1234567.89;
DecimalFormat df = new DecimalFormat("#.#E0");
String result = df.format(number);
```

`패턴을 이용해 숫자를 다르게 변환하기`

```java
DecimalFormat df = new DecimalFormat("#,###.##");
DecimalFormat df2 = new DecimalFormat("#.###E0");

Numer num = df.parse("1,234,567.89");

double d = num.doubleValue();

df2.format(num);
// 결과
// 1,234,567,89 -> 1234567.89 -> 1.23E6
```

> Integer.parseInt 메소드는 콤마 (,) 점(.) 이 들어간 문자열을 숫자로 변환하지 못한다.

### SimpleDateFormat
- 날짜를 형식화 하는 클래스
- **DateFormat** 클래스를 구현하고 있다.
    - getInstance 메소드를 통해 반환 되는 것은 SimpleDateFormat 클래스
- Thread-Safe 하지 않다.

```java
Date today = new Date();
SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd");
String result = df.format(today);
```

> Java8 에 추가된 DateTimeFormatter 사용 권장

`Java 8 DateTimeFormatter`

```java
DateTimeFormatter format = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
LocalDateTime.parse("2021-01-18 20:00:0", format);
```

`JodaTime DateTimeFormat`

```java
DateTimeFormat format = DateTimeFormat.forPattern("yyyy-MM-dd HH:mm:ss")
DateTime.parse("2021-01-18 20:00:0", format);
```

### ChoiceFormat
- 특정 범위에 속하는 값을 문자열로 반환해준다.
- 연속적 혹은 불연속적인 범위의 값들을 처리하는데 있어서 if 나 switch 문은 적절하지 못한 경우가 많다.
- ChoiceFormat 을 잘 사용해 간단하고 직관적인 코드 작성이 가능하다.

```java
double[] limits = {60, 70, 80, 90};

String[] grades = {"D", "C", "B", "A"};

int scores = {100, 95, 88, 70, 52, 60, 70};

ChoiceFormat form = new ChoiceFormat(limits, grades);

for (int i = 0; i < scores.length; i++) {
	scores[i];
    form.format(scores[i]);   
}
// 100: A
// 95: A
// 88: B
// 70: C
// 52: D
// 60: D
// 70: C
```
- 위 코드는 두 개의 배열이 사용 되었다.
  - 범위 경계값 저장
  - 범위에 포함된 값을 치환할 문자열 저장
- 경계값은 **반드시 오름차순으로 정렬** 되어 있어야 한다.
- 치환될 문자열의 갯수는 경계값의 범위 개수와 일치해야 한다.
  - 그렇지 않을 경우 IllegalArgumentException 이 발생함

```java
String pattern = "60#D|70#C|80<B|90#A";

int scores = {91, 90, 80, 88, 70, 52, 60};

ChoiceFormat form = new ChoiceFormat(pattern);

for (int i = 0; i < scores.length; i++) {
    scores[i];
    form.format(scores[i]);
}
// 91: A
// 90: A
// 80: C
// 88: B
// 70: C
// 52: D
// 60: D
```
- 배열 대신 패턴을 사용하는 방법
- 구분자로 # 과 < 두가지를 제공한다.
  - limit#value 의 형식
  - \# : 지정된 경계값을 포함
  - < : 지정된 경계값을 포함시키지 않음

### MessageFormat
- 데이터를 정해진 양식에 맞게 출력한다.

```java
String msg = "Name: {0} \nTel: {1} \nAge:{2} \nBirthday:{3}";

Object[] arguments = {
    "이자바", "02-123-1234", "27", "07-09"
};

String result = MessageFormat.format(msg, arguments);
// Name: 이자바
// Tel: 02-123-1234
// Age: 27
// Birthday: 07-09
```
- {n} 의 형태로 표시된 부분이 데이터가 출력될 자리이고, 배열처럼 인덱스가 0 부터 시작한다.
- 홑따옴표 (') 는 MessageFormat 의 양식에서 escape 문자로 사용되기 때문에 필요시 연속으로 두번 사용 해야 한다.

## java.time 패키지
- Date 와 Calendar 의 단점들을 해소하기 위해 JDK 1.8 부터 추가되었다.
- 이 패키지에 속한 클래스들은 String 과 마찬가지로 **Immutable** 하다.
- java.time
  - 날짜와 시간을 다루는 핵심 클래스 제공
- java.time.chrono
  - 표준 (ISO) 가 아닌 달력 시스템을 위한 클래스 제공
- java.time.format
  - 날짜와 시간을 파싱 / 형식화 하기 위한 클래스 제공
- java.time.temporal
  - 날짜와 시간의 필드 / 단위를 위한 클래스 제공
- java.time.zone
  - 시간대 (time-zone) 와 관련된 클래스 제공

### java.time 핵심 클래스
- LocalDate
  - 날짜 표현시 사용
- LocalTime
  - 시간 표현시 사용


## 참고
- https://d2.naver.com/helloworld/645609#note02