# 지옥 스터디 - 11 31가지 맛
- 개인 연락처 정보 테이블에서 **호칭 (salutation)** 은 몇 가지 값만 갖는 칼럼의 좋은 예이다.
- Mr. Mrs. Dr. Rev. 를 지원하면 사실상 거의 모든 사람을 고려한 것이다.
- 이를 데이터 타입 또는 제약조건을 이용해 칼럼 정의에 지정한 뒤 실수로 다른 문자열이 입력되지 않도록 할 수 있다.

```sql
CREATE TABLE PersonalContacts (
    ...,
    salutation VARCHAR(4)
          CHECK (salutation IN ('Mr.', 'Mrs.', 'Ms.', 'Dr.', 'Rev.'))
);
```
- 하지만 프랑스 자회사 설립이후 이를 지원해야 한다면 M., Mme., Mlle. 도 지원해야 한다.
- 이런 값도 지원하도록 연락처 테이블을 변경하는 것이 이번 장의 과제이다.

## 목표 : 칼럼을 특정 값으로 제한하기
- 칼럼의 값을 **고정된 집합의 값으로 제한** 하는 것은 매우 유용하다.
- 해당 칼럼이 유효하지 않은 항목을 절대 포함하지 않는다고 보장할수 있으므로 칼럼을 사용하는 것이 단순해 진다.
- Bugs 테이블의 status 칼럼은 주어진 버그에 대해 NEW, IN PROGRESS, FIXED 값을 가진다.
- 유효하지 않은 값은 데이터베이스가 거부하는 것이 이상적이다.

## 안피패턴 : 칼럼 정의에 값 지정
- 많은 사람들이 칼럼을 정의할 때 유효한 데이터 값을 지정한다.
- 칼럼 정의는 메타데이터, 즉 테이블 구조 정의의 일부이다.
- 칼럼에 CHECK 제약 조건을 사용해 이를 수행할 수 있다.

```sql
CREATE TABLE Bugs (
    ...,
    status VARCHAR (20) CHECK (status IN ('NEW', 'IN PROGRESS', 'FIXED'))
);
```
- MySQL 이라면 ENUM 이라는 비표준 데이터 타입을 지원한다.

```
CREATE TABLE Bugs (
    ...,
    status ENUM ('NEW', 'IN PROGRESS', 'FIXED')
);
```
- 다른 방법은 도메인이나 사용자 정의 타입을 사용하는 것이다.
- 이를 이용해 칼럼에 미리 지정한 값만 허용하도록 제한하고, 동일한 도메인이나 데이터 타입을 데이터베이스 내 여러 칼럼에 적용할 수 있다.
- 또 다른 방법은 미리 허용된 값을 확인하고 다른 값이 들어오면 에러가 발생하도록 트리거를 사용하는 것이다.
- 이 방법들은 모두 단점을 가지고 있다.

### 중간에 있는 게 뭐지 ?
- 버그 추적시스템의 사용자 인터페이스를 개발중이라고 가정하자.
- 사용자는 버그를 편집할 수 있고, 사용자가 유효한 상태 값 중 하나를 선택하게 하기 위해 드롭다운 메뉴 컨트롤에 채우기로 했다.
- 어떤 쿼리를 날려야지 **status 칼럼에 허용되는 값의 목록** 을 얻을 수 있을까 ?

```sql
SELECT column_type
FROM information_scheama.columns
WHERE table_schema = 'bugtracker_schema'
AND table_name = 'bugs'
AND column_name = 'status';
```
- status 에 허용된 목록을 얻으려면 칼럼의 **메타데이터** 를 조회해야 한다.
- 체크 제약조건, 도메인, 사용자 정의 타입을 확인해야 한다면 쿼리는 점점 더 복잡해진다.