# 지옥 스터디 - 24 외교적 면책특권

## 24.1 목표 : 관례 따르기

전문적인 개발자들은 프로젝트에서 다음과 같은 좋은 소프트웨어 공학적 습관을 사용하려 노력한다.
- 버전 관리 도구를 사용해 소스 코드 관리한다.
- 애플리케이션을 위한 자동화된 단위 테스트나 기능 테스트를 개발하고 실행한다.
- 애플리케이션의 요구사항과 구현 전략을 기록하기 위해 명세서, 문서, 코드 주석을 사용한다.

**불필요하거나 반복적인 작업** 을 대폭 줄여주기 때문에 관례를 사용해 개발하는 경우 들어가는 시간도 전체적으로 이익이다. <br/>
대부분의 개발자들은 편의를 위해 이와 같은 관례를 따르지 않는 것이 실패의 지름길이라 생각한다.

## 24.2 안티패턴 : SQL 을 2등 시민으로 만들기

데이터베이스 코드 작성시 이런 관례로부터 면제된다고 생각하는 개발자들이 있다. <br/>
이 안티패턴을 **외교적 면책특권** 이라 부른다. <br/>
개발자들이 이런 생각을 가지는 이유는 다음과 같다.
- 소프트웨어 개발자와 DBA 역할이 분리되어 있다. 보통 DBA 는 여러 개발팀을 지원하기 때문에 방문자로 취급되며, 소프트웨어 엔지니어와 같은 책임이 따른다고 생각하지 않는다.
- 관계형 데이터베이스에서 사용되는 SQL 언어는 일반 프로그래밍 언어와 다르다.
- 애플리케이션 코드 개발을 위한 IDE 상당히 편리한 부분이 많지만 데이터베이스 개발을 위한 도구는 그 정도로 발전되지 않았고 널리 사용되지 않았다. SQL 에서도 이런 관례를 적용하는 것에 대해 불편함을 느낀다.
- IT 분야에서 데이터베이스 운영과 지식은 DBA 에게 집중 되는 것이 보통이다. 데이터베이스 서버에 접속 가능한 유일한 사람으로, 지식베이스와 소스 관리 시스템 역할을 한다.

## 24.3 안티패턴 인식 방법

무언가를 안하는 것에 대한 증거를 찾기란 어렵다 생각할 수 있지만, 항상 그런것만은 아니다. <br/>
다음은 지름길을 가려고 하는 것에 대한 징조라 할 수 있다.
- 우리는 새로운 엔지니어링 프로세스를 채택했어. 즉 그것의 경량 버전이야.
  - 여기서 경량은 프로세스가 요구하는 몇몇 작업을 생략하려는 의도를 의미한다.
  - 중요 관례를 따르지 않겠다는 말을 완곡하게 표현한 것일 수도 있다.
- 새로운 소스 관리 시스템 교육에 DBA 들은 참여하지 않아도 돼
- 데이터베이스에서 테이블과 칼럼의 사용률을 어떻게 추적할수 있을까 ? 사용되지 않는다면 삭제해버리려구.
- 두 데이터베이스 스키마를 비교해 차이점을 보고하고, 한 쪽을 다른 한쪽에 맞추는 스크립트를 생성하는 도구가 없을까 ?

## 24.4 안티패턴 사용이 합당한 경우

한 번 이상 사용할 모든 코드에 대해 문서와 테스트를 작성하고, 소스 관리도구나 기타 좋은 습관을 사용한다. <br/>
코드가 정말 임시적인지 확인하는 방법은 코드 사용후 바로 지워버리는 것이다. <br/>
만약 그렇게 할 수 없다면 보관할 가치가 있을 것이다. <br/>
그러나 이는 코드를 소스 관리 도구에 저장해야하고 최소한 코드의 목적과 사용방법 정도의 간단한 기록은 남길 가치가 있음을 뜻한다.

## 24.5 해법: 초당적 품질 문화 확립

품질은 대부분의 개발제에게는 단순히 테스트를 의미한다. <br/>
이는 단지 품질제어 일 뿐이며 이야기의 일부일 뿐이다. <br/>
소프트웨어 공학의 전체 생명주기에는 다음 세 부분이 포함되는데 QA (Quality Assurance, 품질 보증) 도 수반된다.
1. 프로젝트 요구사항을 문서로 명확하게 명세한다.
2. 요구사항에 대한 솔루션을 설계하고 개발한다.
3. 솔루션이 요구사항에 맞는지 검토하고 테스트한다.
QA 를 올바르게 수행하기 위해선 이 세단계가 모두 필요하다.

### 증거1: 문서화

애플리케이션과 마찬가지로 데이터베이스에 대해서도 요구사항과 구현에 대한 문서를 만들어야 한다.<br/>
데이터베이스의 원래 설계자이든, 다른 사람이 설계한 데이터베이스를 받았던 간에 문서화를 위해 다음 체크리스트를 사용해야 한다.
- ERD
- 테이블, 칼럼, 뷰
- 관계
- 트리거
- 저장 프로시저
- SQL 보안
- 데이터베이스 기반 구조
- 객체-관계 매핑

### 증거의 흔적: 소스코드 제어

애플리케이션과 마찬가지로 데이터베이스 코드에 대해서도 소스관리 시스템을 사용해 비슷한 이익을 얻을 수 있다. <br/>
데이터베이스 개발과 관련된 모든 파일을 소스 관리 시스템에 보관해야 하는데, 다음과 같은 것이 포함된다.
- 데이터 정의 스크립트
- 트리거와 프로시저
- 부트스트랩 데이터
- ERD 와 문서
- DBA 스크립트

### 입증 책임: 테스트

QA 의 마지막 부분은 품질 제어, 즉 애플리케이션이 기대대로 동작하는지를 검증하는 것이다. <br/>
테스트에서 중요한 원칙중 하나는 **격리 (isolation)** 이며, 한 번에 시스템의 한 부분씩 테스트해서 결함이 발견되면 그 결함이 어느 부분에 있는 것인지를 가능한 정확하게 알 수 있어야 한다. <br/>
데이터베이스를 검증하는 테스트에 다음 체크리스트를 활용할 수 있다.
- 테이블, 칼럼, 뷰
- 제약조건
- 트리거
- 저장 프로시저
- 부트스트랩 데이터
- 쿼리
- ORM 클래스

### 담당 건수: 여러 브랜치에서 작업하기

애플리케이션을 개발하면서 코드의 여러 리비전을 작업할 수도 있다. <br/>
애플리케이션이 사용하는 데이터베이스는 버전 관리하에 있지 않다. <br/>
이상적으로는, 각 애플리케이션의 리비전마다 별도의 데이터베이스 인스턴스를 생성하는 것이 좋다. <br/>
프로젝트 팀의 각 개발자가 별도의 데이터베이스 인스턴스를 가져 다른 팀원의 개발에 영향을 주지 않으면서 작업할 수 있어야 한다.

## SQL Antipatterns Tip

애플리케이션뿐만 아니라 데이터베이스에 대해서도 문서화, 테스트, 소스 코드와 같은 소프트웨어 개발 관례를 사용하라.


