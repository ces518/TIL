# RabbitMQ In Depth

## 1. RabbitMQ 살펴보기

### RabbitMQ 기능과 장점
- 오픈소스
  - 모질라 공공 라이센스 (Mozilla Public)
- 플랫폼과 업체 중립성
  - AMQP (Advanced Message Queuing Protocol) 스펙을 구현한 메세지 브로커
  - 대부분의 언어와 주요 플랫폼 클라이언트를 제공
- 경량성
  - RabbitMQ 는 관리자 UI 플러그인과 코어 애플리케이션 구동시 40MB 미만 메모리를 사용
- 다양한 클라이언트 라이브러리
  - 대부분의 언어와 주요 플랫폼 클라이언트 라이브러리를 제공
- 유연한 성능과 안정성 절충 제어
  - 안정적인 메세지 전달 및 메세지 처리량 혹은 성능을 유연하게 제어 가능한 옵션을 제공
  - 메세지 배달 전 디스크에 저장 가능하도록 설정이 가능하며, 클러스터 설정시 HA (고가용성) 설정이 가능하다.
- 대기 시간이 긴 네트워크 환경을 위한 플러그인
  - 실제 시스템의 네트워크 토폴로지와 아키텍쳐는 다양하게 구성된다.
  - 때문에 RabbitMQ 는 대기 시간이 짧은 네트워크 환경의 메세지 전달은 기본 코어 모듈로서 제공
  - 긴 대기시간을 가지는 네트워크 환경의 메세지 전달은 플러그인을 통해 제공한다.
  - RabbitMQ 를 이용해 동일한 로컬 네트워크에 클러스터 구성이 가능하며 Federation 플러그인으로 여러 데이터센터 간의 메세지 공유가 가능하다.
- 서드파티 플러그인
  - RabbitMQ 는 유연한 플러그인 시스템을 제공
  - RabbitMQ 를 사용해 메세지를 데이터베이스에 직접 저장하는 서드파티 플러그인 등을 제공
- 보안 계층
  - 보안을 여러 단계로 제공한다.
  - 클라이언트 접속은 SSL 만으로 제한하고, Vhost(가상 호스트) 로 사용자 접근을 관리하며, 구성 기능에 대한 접근/큐에서 읽기/익스체인지 쓰기 등은 정규식 패턴 매칭으로 관리한다.
  - LDAP 과 같은 외부 인증 시스템을 연동하는 플러그인 사용도 가능하다.

### RabbitMQ 와 얼랭
- RabbitMQ 는 클러스터링 기능이 있는 메세지 브로커 이다
- 미션 크리티컬한 환경에서 대규모 메시지 지향 아키텍처의 핵심 구성 요소로 사용된다.
- RabbitMQ 는 1980년대 중후반 에릭슨 컴퓨터 과학 연구소에서 설계한 함수형 언어인 얼랭으로 개발되었다.
- 얼랭은 분산처리, 장애허용, 연성 실시간 시스템과 같이 99.999% 의 가동율을 요구하는 애플리케이션을 위해 설계된 언어
- 얼랭은 실시간 시스템에서 경량 프로세스 간 메세지를 전달하고 공유하는 상태가 없도록 설계되어 높은 수준의 동시성을 지원한다.
- RabbitMQ 는 **얼랭의 프로세스간 통신 (IPC, Inter Process Communication)** 를 활용해 클러스터링 기능을 간단히 구현했다.

![Erlang IPC](./images/Erlang_IPC.png)

`실시간 시스템과 연성 실시간 시스템`
- 실시간 시스템 (Real-Time System) 특정 이벤트를 전달하면 반드시 응답을 반환하는 형태이다.
- 연성 실시간 시스템 (Soft-Real-Time System) 은 준 리얼타임 이라고도 한다.
- 작업 실행은 반드시 보장하나, 실행의 최종 기한은 보장하지 않는 시스템을 말한다.

### RabbitMQ 와 AMQP
- RabbitMQ 는 상호 운용성 (Interoperability), 성능, 안정성을 중요한 목표로 개발되었다.
- 2007년 출시 당시 **AMQP (Advanced Message Queuing Protocol)** 을 구현한 최초 메세지 브로커
- AMQP 스펙은 통신프로토콜 뿐 아닌, RabbitMQ 의 핵심 기능 구현을 위한 논리적인 모델에도 영향을 주었다.
- RabbitMQ 는 AMQP 기반으로 구현되었지만, MQTT, STOMP, XMPP 등 다양한 프로토콜도 제공한다.
- RabbitMQ 는 AMQP 스펙을 구현했으며, 주요 아키텍쳐와 통신 방식이 핵심
  - 다른 메세지 브로커와 비교시 중요한 차이점
  - 유연한 메세지 라우팅, 메세지 내구성 설정, 데이터센터 간 통신 등
  - 메세지 지향 아키텍쳐의 요구사항에 대한 벤더 중립적이고 플랫폼 독립적

### 메세지 지향 아키텍쳐
- 메세지 지향 아키텍쳐의 장점 중 주목할 부분은, 시스템 성능에 영향을 줄 수 있다는 점이다.
- 네트워크 문제에서 RabbitMQ 의 메세지 **스로틀링 (Throttling)** 에 이르기 까지 다양한 문제가 메세지 발행자의 성능에 영향을 줄 수 있다.
- 소비자 애플리케이션의 수평 확장 뿐 아닌 메세지 브로커의 수평 확장도 고려해 처리량과 발행자 성능을 개선하는 것이 좋다.

![MDA](./images/RabbitMQ_MDA.png)